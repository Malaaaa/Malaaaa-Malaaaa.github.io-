<!doctype html>
<html lang="fr" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-CSAPP/Linking">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.20">
<title data-rh="true">Linking | My resume</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://malaaa.mljlls.tech//fr/docs/CSAPP/Linking"><meta data-rh="true" name="docusaurus_locale" content="fr"><meta data-rh="true" name="docsearch:language" content="fr"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Linking | My resume"><meta data-rh="true" name="description" content="Traduit le programme d&#x27;exemple d&#x27;un fichier source ASCII en un fichier objet exécutable."><meta data-rh="true" property="og:description" content="Traduit le programme d&#x27;exemple d&#x27;un fichier source ASCII en un fichier objet exécutable."><link data-rh="true" rel="icon" href="/fr/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://malaaa.mljlls.tech//fr/docs/CSAPP/Linking"><link data-rh="true" rel="alternate" href="https://malaaa.mljlls.tech//docs/CSAPP/Linking" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://malaaa.mljlls.tech//fr/docs/CSAPP/Linking" hreflang="fr"><link data-rh="true" rel="alternate" href="https://malaaa.mljlls.tech//zh-CN/docs/CSAPP/Linking" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://malaaa.mljlls.tech//docs/CSAPP/Linking" hreflang="x-default"><link rel="stylesheet" href="/fr/assets/css/styles.cde37931.css">
<link rel="preload" href="/fr/assets/js/runtime~main.fce25c65.js" as="script">
<link rel="preload" href="/fr/assets/js/main.38d4393c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Passer au contenu principal</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/fr/"><div class="navbar__logo"><img src="/fr/img/logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/fr/img/logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title text--truncate">Mon CV</b></a><a class="navbar__item navbar__link navbar__link--active" href="/fr/docs/intro">Mes notes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Malaaaa" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_dNtB"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>Français</a><ul class="dropdown__menu"><li><a href="/docs/CSAPP/Linking" target="_self" rel="noopener noreferrer" class="dropdown__link">English</a></li><li><a href="/fr/docs/CSAPP/Linking" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">Français</a></li><li><a href="/zh-CN/docs/CSAPP/Linking" target="_self" rel="noopener noreferrer" class="dropdown__link">中文（中国）</a></li></ul></div><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Basculer entre les modes sombre et clair (actuellement mode lumière)" aria-label="Basculer entre les modes sombre et clair (actuellement mode lumière)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_dLyj"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_mKqt"><button aria-label="Faites défiler vers le haut" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><div class="docPage_ualW"><aside class="theme-doc-sidebar-container docSidebarContainer_UQUJ"><div class="sidebar_RiAD"><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/fr/docs/Flutter/">Apprentissage flottant</a><button aria-label="Basculer la catégorie de la barre latérale réductible &#x27;Apprentissage flottant&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fr/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fr/docs/ReadingNote">Livres</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/fr/docs/CSAPP/CSAPPNOTE">CSAPP</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fr/docs/CSAPP/CSAPPNOTE">Systèmes informatiques</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fr/docs/CSAPP/Exceptional Control Flow">Flux de contrôle exceptionnel</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/fr/docs/CSAPP/I/O">je</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/fr/docs/CSAPP/Linking">Linking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fr/docs/CSAPP/Network">Network</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fr/docs/HomeChain">HomeChain</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/fr/docs/JavaScript/">Exemple Javascript utile</a><button aria-label="Basculer la catégorie de la barre latérale réductible &#x27;Exemple Javascript utile&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/fr/docs/Linux/WSL/LAMP">Linux</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fr/docs/LinuxConfigNote">Noter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fr/docs/NetworkBS">Réseau informatique de base</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/fr/docs/Nodejs/">Architecture</a><button aria-label="Basculer la catégorie de la barre latérale réductible &#x27;Architecture&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/fr/docs/React/HookUse">Réagir</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/fr/docs/Skill/IDE">Compétence</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/fr/docs/TypeScript/Generics">TypeScript</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fr/docs/Web-Note">Web notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fr/docs/docsify">documenter</a></li></ul></nav></div></aside><main class="docMainContainer_uL0j"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="Fil d&#x27;Ariane"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Page d&#x27;accueil" class="breadcrumbs__link" href="/fr/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_kU5B"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">CSAPP</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Linking</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_bZGK theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_l22C">Sur cette page</button></div><div class="theme-doc-markdown markdown"><header><h1>Linking</h1></header><h3 class="anchor anchorWithStickyNavbar_mojV" id="traduit-le-programme-dexemple-dun-fichier-source-ascii-en-un-fichier-objet-exécutable">Traduit le programme d&#x27;exemple d&#x27;un fichier source ASCII en un fichier objet exécutable.<a class="hash-link" href="#traduit-le-programme-dexemple-dun-fichier-source-ascii-en-un-fichier-objet-exécutable" title="Lien direct vers la rubrique">​</a></h3><p><img loading="lazy" alt="img_6.png" src="/fr/assets/images/img_6-ce6a03bde9531a6cbe27f45be64d85e2.png" width="554" height="141" class="img_E7b_"></p><ol><li>Préprocesseur C : cpp <!-- -->[autres arguments]<!-- --> hello.c /tmp/main.i</li><li>Compilateur C : cc1 /tmp/hello.i -Og <!-- -->[autres arguments]<!-- --> -o /tmp/hello.s</li><li>assembleur : as <!-- -->[autres arguments]<!-- --> -o /tmp/hello.o /tmp/hello.s</li><li>programme de liaison : ld -o hello <!-- -->[fichiers d&#x27;objet système et arguments]<!-- --> /tmp/hello.o /libc.a/printf.o</li><li>programme exécutable : linux&gt; ./hello</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="fichiers-objet">Fichiers objet<a class="hash-link" href="#fichiers-objet" title="Lien direct vers la rubrique">​</a></h3><p>Format exécutable et connectable (ELF). <img loading="lazy" alt="img_3.png" src="/fr/assets/images/img_3-f6ba88724de654678c793e808d4d1437.png" width="824" height="684" class="img_E7b_"></p><ul><li><p>.text Le code machine du programme compilé.</p></li><li><p>.rodata <strong>Données en lecture seule</strong> telles que les chaînes de format dans les instructions printf et tables de sauts pour les instructions switch.</p></li><li><p>.data Variables C globales et statiques initialisées. Les variables C locales sont maintenues à au moment de l&#x27;exécution sur la pile et n&#x27;apparaissent ni dans les sections .data ni .bss .</p></li><li><p>.bss Variables C globales et statiques non initialisées, ainsi que toutes les variables globales ou statiques initialisées à zéro. Aucun espace n&#x27;a les mêmes adresses avec .comment.</p></li><li><p>.symtab Une table de symboles avec des informations sur les fonctions et les variables globales qui sont définies et référencées dans le programme.</p></li><li><p>.rel Informations de relocalisation</p></li><li><p>.line Un mappage des numéros de ligne</p></li><li><p>.strtab Une table de chaînes</p></li><li><p>Fichier objet déplaçable. Contient du code binaire et des données sous une forme qui peut être combinée avec d&#x27;autres fichiers objets réadressables au moment de la compilation pour créer un fichier objet exécutable.</p></li><li><p>Fichier objet exécutable. Contient du code binaire et des données sous une forme qui peut être copiée directement dans la mémoire et exécutée. <img loading="lazy" alt="img_2.png" src="/fr/assets/images/img_2-7ea081012bfb8ce50223762d38db5d56.png" width="1236" height="694" class="img_E7b_"></p></li><li><p>Fichier objet partagé. Un type spécial de fichier objet relocalisable qui peut être chargé en mémoire et lié dynamiquement, au moment du chargement ou de l&#x27;exécution.</p></li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="symboles">Symboles<a class="hash-link" href="#symboles" title="Lien direct vers la rubrique">​</a></h4><ul><li>Symboles globaux définis par le module m et pouvant être référencés par autres modules. OU référencé par le module m mais défini par un autre module .</li><li>Symboles locaux définis et référencés exclusivement par le module m.</li></ul><h6 class="anchor anchorWithStickyNavbar_mojV" id="comment-les-éditeurs-de-liens-résolvent-les-noms-de-symboles-en-double">Comment les éditeurs de liens résolvent les noms de symboles en double<a class="hash-link" href="#comment-les-éditeurs-de-liens-résolvent-les-noms-de-symboles-en-double" title="Lien direct vers la rubrique">​</a></h6><p>symboles forts : int i = 1 ; symboles faibles : int i ; int principal(i =1); int <strong>attribut</strong>((faible)) power2(int x);int power2(int x) <strong>attribut</strong>((faible));extern int <strong>attribut</strong>((faible)) global_var; Règle 1. Plusieurs symboles forts portant le même nom ne sont pas autorisés. Règle 2. Étant donné un symbole fort et plusieurs symboles faibles portant le même nom, choisit le symbole fort. Règle 3. Étant donné plusieurs symboles faibles portant le même nom, choisissez l&#x27;un des symboles faibles.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="déménagement">Déménagement<a class="hash-link" href="#déménagement" title="Lien direct vers la rubrique">​</a></h4><ol><li><p>Déplacement des sections et des définitions de symboles. Dans cette étape, l&#x27;éditeur de liens fusionne toutes les sections du même type dans une nouvelle section agrégée du même type.</p></li><li><p>Déplacement des références de symboles dans les sections. Dans cette étape, l&#x27;éditeur de liens modifie chaque référence de symbole dans les corps des sections de code et de données afin qu&#x27;ils vers les adresses d&#x27;exécution correctes.</p></li></ol><p>Les entrées de relocalisation pour le code sont placées dans .rel.text. Les entrées de relocalisation pour les données sont placées dans .rel.data.</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">/*main.c*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void swap();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int buf[2] = {1, 2};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int main() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    swap();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    retour 0 ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*swap.c*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">extern int buf [] ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int *bufp0 = &amp;buf[0] ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">entier *bufp1 ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void swap() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int temp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bufp1 = &amp;buf[1];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    temp =*bufp0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    *bufp0 = *bufp1 ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    *bufp1 = temp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copie" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">malaaa@malaaa-N8xxEP6&gt; gcc -c swap.c -o swap.o//Fichier objet réadressable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">malaaa@malaaa-N8xxEP6&gt; gcc -c main.c -o main.o//Fichier objet réadressable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">malaaa@malaaa- N8xxEP6&gt; gcc -g swap.o main.o -o run//Fichier objet exécutable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">malaaa@malaaa-N8xxEP6&gt; readelf -s swap.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">malaaa@malaaa-N8xxEP6&gt; readelf -s main.o</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copie" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Résultat</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">swap.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">La table de symboles &#x27;.symtab&#x27; contient 14 entrées :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Num : Valeur Taille Type Bind Vis Ndx Name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     0 : 0000000000000000 0 NOTYPE LOCAL DEFAULT UND </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     1 : 0000000000000000 0 FILE LOCAL DEFAULT ABS swap.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     2 : 0000000000000000 0000000 0000000000000000 Section locale 1 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     3: 0000000000000000 0 Section Local 3 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     4: 0000000000000000 0 Section Local local 4 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     5: 0000000000000000 0 section locale 5 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     6: 0000000000000000 0 Section Local local 8 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     7: 0000000000000000 0 Section Local local 9 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     8: 000000000000000000 0 section locale 10 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     9: 0000000000000000 0 Section Local Par défaut 7 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    10: 0000000000000000 0 VOCAL GLOBAL 5 BUFP0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    11: 0000000000000000 0 NOTYPE GLOBAL DEFAULT UND BUF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    12: 0000000000000000 8 Objet Global Par défaut 4 BUFP1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    13: 0000000000000000 67 FUNC GLOBAL DEFAULT 1 échange</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copie" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>buf, 是 swap.o.symtable 的 条 目, extern 的 符号,<strong>在 Main.O 中 定义!</strong>, 们们 看到 一个 关于 全局 是 从 的 条 目, 它 从 .Data 中 偏移 为 0 处开始的一个 8 字节的已初始化目标. \ bufp0：是 swap.o.symtable 的 条 目, global 类型 符号, 在 Swap.o 中 定义, 们 看到 一个 关于关于 们 Bufpo 的 条条 它 是 从 .Data 中 偏移 为 0 处 的 一个8 的 已 初 始化 目标 目标 bufp1：是 swap.o.symtabl 的 条 目, global 的 符号, 在 Swap.o 中 定义, 它 的 8 字节 数据 目标 初 的 8 字节 数据 目标 初 的 8 字节 数据 (要求 8 字节),最终当这个模块被链接时它将作为一个.bss目标分配\ échange：是swap.o.symTable的条目, func类型的符号,在中定义swap.o,它是一个位于.text中偏移为零处的 67 字节的函数。 \ temp：不属于swap.o.symTable条目，int类型的符号，在swap.o中定义，局部变量位与栈位于栈位与栈</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">main.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">La table des symboles &#x27;.symtab&#x27; contient 13 entrées :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Num : Valeur Taille Type Bind Vis Ndx Nom</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 : 0000000000000000 0 NOTYPE LOCAL DEFAULT UND</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 : 0000000000000000 0 FILE LOCAL DEFAULT ABS main.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2 : 0000000000000000 0 Section Local Local Par défaut 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3: 0000000000000000 0 Section Local local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4: 0000000000000000 0 Section Local Local Par défaut 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6: 0000000000000000 0 Section Local local 7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7: 0000000000000000 0 Section Local Local 8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8: 0000000000000000 0 section locale 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9: 0000000000000000 8 Global d&#x27;objet Par défaut 3 buf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10: 0000000000000000 25 FUNC GLOBAL 1 MAIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">11: 0000000000000000 0 NOTYPEL GLOBAL DEFAULT UND _GLOBAL_OFFSET_TABLE_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">12: 00000000000000 0 NOTYPE GLOBAL DEFAULT UND SWAP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copie" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>buf 是已经初始化的全局变量，一个位于.data节中偏移位0的8字节目标。 \ main 位于.text节中偏移为0的25字字</p><h6 class="anchor anchorWithStickyNavbar_mojV" id="entrées-de-relocalisation-dobjdump">entrées de relocalisation d&#x27;objdump<a class="hash-link" href="#entrées-de-relocalisation-dobjdump" title="Lien direct vers la rubrique">​</a></h6><p><code>objdump -D -r swap.o</code> -d just .text Résultat</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">swap.o: format de fichier elf64-x86-64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Désassemblage de la section .text:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000000000000000 &lt;swap&gt; :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0: f3 0f 1e fa endbr64 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   4: 55 push %rbp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   5: 48 89 e5 mov %rsp,%rbp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   8: 48 8d 05 00 00 00 00 lea 0x0(%rip),%rax # f &lt;swap+0xf&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            b: R_X86_64_PC32 buf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   f: 48 89 05 00 00 00 00 mov %rax,0x0(%rip) # 16 &lt;swap+0x16&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            12 : R_X86_64_PC32 bufp1-0x4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  16: 48 8b 05 00 00 00 00 mov 0x0(%rip),%rax # 1d &lt;swap+0x1d&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            19: R_X86_64_PC32 bufp0-0x4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1d: 8b 00 mov (%rax),%eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1f: 89 45 fc mov    %eax,-0x4(%rbp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  22: 48 8b 15 00 00 00 00 mov 0x0(%rip),%rdx # 29 &lt;swap+0x29&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            25: R_X86_64_PC32 bufp1-0x4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  29: 48 8b 05 00 00 00 00 mov 0x0(%rip),%rax # 30 &lt;swap+0x30&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2c: R_X86_64_PC32 bufp0-0x4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  30: 8b 12 mov (%rdx),%edx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  32: 89 10 mov    %edx,(%rax)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  34: 48 8b 05 00 00 00 00 mov 0x0(%rip),%rax # 3b &lt;swap+0x3b&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            37: R_X86_64_PC32 bufp1-0x4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  3b: 8b 55 fc mov -0x4(%rbp),%edx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  3e: 89 10 mov    %edx ,(%rax)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  40 : 90 nop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  41 : 5d pop %rbp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  42 : c3 retq   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Démontage de la section .bss :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000000000000000 &lt;bufp1&gt; :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Démontage de la section .data.rel :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000000000000000 &lt;bufp0&gt; :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            0 : R_X86_64_64 buf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Démontage de section .comment :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000000000000000 &lt;.comment&gt; :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0 : 00 47 43 add    %al,0x43(%rdi)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   3 : 43 3a 20 rex.XB cmp (%r8),%spl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   6 : 28 55 62 sub    %dl,0x62(%rbp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   9 : 75 6e jne 79 &lt;swap+0x79&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   b : 74 75 je 82 &lt;swap+0x82&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   d : 20 31 et    %dh,(%rcx)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   f : 30 2e xor    %ch,(%rsi)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  11 : 32 2e xor (%rsi),%ch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  13 : 30 2d 31 33 75 62 xor    %ch,0x62753331(%rip) # 6275334a &lt;swap+0x6275334a&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  19 : 75 6e jne 89 &lt;swap+0x89&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1b : 74 75 je 92 &lt;swap+0x92&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1d : 31 29 xor    %ebp,(%rcx)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1f : 20 31 et    %dh,(%rcx)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  21 : 30 2e xor    %ch,(%rsi)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  23 : 32 2e xor (%rsi),%ch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  25 : 30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &gt;%al,(%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &lt;de la section $0x0,%al</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   2 : 00 00 ajouter    %al,(%rax)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   4 : 10 00 adc    %al,(%rax)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   6 : 00 00 ajouter    %al,(%rax)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   8 : 05 00 00 00 47 ajouter $0x47000000,%eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   d : 4e 55 rex.WRX push %rbp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   f : 00 02 ajouter    %al,(%rdx)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  11 : 00 00 ajouter    %al,(%rax)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  13 : c0 04 00 00 rolb $0x0,(%rax,%rax,1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  17: 00 03 ajouter    %al,(%rbx)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  19: 00 00 ajouter    %al,(%rax)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1b : 00 00 ajouter    %al,(%rax)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1d : 00 00 ajouter    %al,(%rax)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Démontage de la section .eh_frame :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000000000000000 &lt;.eh_frame&gt; :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0 : 14 00 adc $0x0,%al</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   2 : 00 00 add    %al,(%rax)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   4 : 00 00 add    %al,(%rax)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   6 : 00 00 ajouter    %al,(%rax)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   8 : 01 7a 52 ajouter    %edi,0x52(%rdx)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   b : 00 01 ajouter    %al,(%rcx)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   d : 78 10 js 1f &lt;. eh_frame+0x1f&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   f : 01 1b ajouter    %ebx,(%rbx)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  11 : 0c 07 ou $0x7,%al</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  13 : 08 90 01 00 00 1c ou     %dl,0x1c000001(%rax)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  19 : 00 00 ajouter    %al,(%rax)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1b : 00 1c 00 ajouter    %bl,(%rax,%rax,1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1e : 00 00 ajouter    %al,(%rax)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  20 : 00 00 ajouter    %al, (%rax)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            20 : R_X86_64_PC32 .text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  22 : 00 00 ajouter    %al,(%rax)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  24 : 43 00 00 rex.XB ajouter %al,(%r8)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  27 : 00 00 ajouter    %al,( %rax)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  29 : 45 0e rex.RB (mauvais) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  2b : 10 86 02 43 0d 06 adc    %al,0x60d4302(%rsi)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  31 : 7a 0c jp 3f &lt;swap+0x3f&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  33 : 07 (mauvais)  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  34 : 08 00 ou     %al,(%rax)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copie" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="fichiers-objet-exécutables">Fichiers objet exécutables<a class="hash-link" href="#fichiers-objet-exécutables" title="Lien direct vers la rubrique">​</a></h4><p><img loading="lazy" alt="img_4.png" src="/fr/assets/images/img_4-920357f5483a3c3f2b2dfde382453ae8.png" width="1310" height="680" class="img_E7b_"> Table d&#x27;en-tête de programme <strong>Lecture seule</strong></p><h4 class="anchor anchorWithStickyNavbar_mojV" id="chargement-de-fichiers-dobjets-exécutables">Chargement de fichiers d&#x27;objets exécutables<a class="hash-link" href="#chargement-de-fichiers-dobjets-exécutables" title="Lien direct vers la rubrique">​</a></h4><p>Le chargeur **** copie le code et les données du fichier objet exécutable du disque dans la mémoire, puis exécute le programme en sautant à sa première instruction, ou point d&#x27;entrée. \ Le segment de code commence à l&#x27;adresse 0x400000, 对于 Linux 而, 0x400000 的 空间 默认 程序 的 作用. 起到 保护 程序 的 作用. 起到 保护 程序 安全 程序 程序 安全 操作 系统 保证 因此 大 限度 利用\ le segment de données.\ le tas.\ le réservé aux modules partagés.\ la pile utilisateur. en dessous de la plus grande adresse utilisateur légale (2 48 − 1) et croît vers le bas, vers des adresses mémoire plus petites.\ la partie kernel.memory-resident du système d&#x27;exploitation.</p><p><img loading="lazy" alt="img_5.png" src="/fr/assets/images/img_5-1312c575e79c44ef649452c1944c51c6.png" width="1014" height="940" class="img_E7b_"></p><h4 class="anchor anchorWithStickyNavbar_mojV" id="liaison-statique">Liaison statique<a class="hash-link" href="#liaison-statique" title="Lien direct vers la rubrique">​</a></h4><ul><li>Symbol resolution.symbol : une fonction, une variable globale ou une variable statique (le modèle &#x27;main(int i = 0)&#x27; est une instruction)</li><li>Relocation.Les compilateurs et les assembleurs génèrent des sections de code et de données qui commencent à l&#x27;adresse 0.</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="liaison-dynamique">Liaison dynamique<a class="hash-link" href="#liaison-dynamique" title="Lien direct vers la rubrique">​</a></h4><p>Une bibliothèque partagée __ est un module objet qui, au moment de l&#x27;exécution ou du chargement , peut être chargé à une adresse mémoire arbitraire et lié à un programme en mémoire . \ Les systèmes Linux sont indiqués par le suffixe .so. Les systèmes d&#x27;exploitation Microsoft font un usage intensif des bibliothèques partagées, qu&#x27;ils appellent DLL.</p><p>Les bibliothèques partagées sont « partagées » de deux manières différentes.</p><ol><li>exactement un fichier .so pour une bibliothèque particulière. Le code et les données sont partagés par tous les fichiers objets exécutables qui référencent la bibliothèque,</li><li>La section .text en mémoire peut être partagée par différents processus en cours d&#x27;exécution. <img loading="lazy" alt="img_7.png" src="/fr/assets/images/img_7-3e602ac16c6f7bc20aa75cf5499d068d.png" width="1032" height="866" class="img_E7b_"></li></ol><h5 class="anchor anchorWithStickyNavbar_mojV" id="léditeur-de-liens-dynamique-termine-ensuite-la-tâche-de-liaison-en-effectuant-les-déplacements-suivants">L&#x27;éditeur de liens dynamique termine ensuite la tâche de liaison en effectuant les déplacements suivants :<a class="hash-link" href="#léditeur-de-liens-dynamique-termine-ensuite-la-tâche-de-liaison-en-effectuant-les-déplacements-suivants" title="Lien direct vers la rubrique">​</a></h5><ul><li>Déplacer le texte et les données de libc.so dans un segment de mémoire</li><li>Déplacer le texte et les données de libvector.so dans un autre segment de mémoire</li><li>Déplacer toutes les références dans prog2l vers les symboles définis par libc.so et libvector.so</li></ul><h5 class="anchor anchorWithStickyNavbar_mojV" id="le-dynamic-linking-est-une-technique-puissante-et-utile-">Le Dynamic Linking est une technique puissante et utile :<a class="hash-link" href="#le-dynamic-linking-est-une-technique-puissante-et-utile-" title="Lien direct vers la rubrique">​</a></h5><ul><li>Distribution de logiciels. utiliser des bibliothèques partagées pour distribuer les mises à jour logicielles.</li><li>Construire des serveurs Web performants. générer du contenu dynamique en utilisant une approche plus efficace et sophistiquée basée sur la liaison dynamique . les requêtes ultérieures peuvent être traitées au prix d&#x27;un simple appel de fonction. fonctions existantes peuvent être mises à jour et de nouvelles fonctions peuvent être ajoutées au moment de l&#x27;exécution, sans arrêter le serveur.</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="code-indépendant-de-la-position-pic">Code indépendant de la position (PIC)<a class="hash-link" href="#code-indépendant-de-la-position-pic" title="Lien direct vers la rubrique">​</a></h4><p>Le code qui peut être chargé sans nécessiter de déplacement est appelé code indépendant de la position (PIC). Les utilisateurs dirigent les systèmes de compilation GNU pour générer du code PIC avec l&#x27;option -fpic de gcc. Les bibliothèques partagées doivent toujours être compilées avec cette option.</p><p>Le génère également une relocalisation. record pour chaque entrée dans le GOT. <img loading="lazy" alt="img_8.png" src="/fr/assets/images/img_8-2c2e9c5bbe85954467a1e2ea069981b5.png" width="1320" height="568" class="img_E7b_"> 由于器 无法 的 的 的 的 的 的 的 的 的都 在 数据 节节 中 创建 一 函数函数 xxx @ plt, 然后 将 中调用 地址 替 换 代码 中调用 地址 替 所以 所以 通过 xxx @ xxx @ Plot 的 更更, 以及 指向 的 更. la table de liaison de procédure (PLT). Si un module objet appelle des fonctions définies dans des bibliothèques partagées, il possède alors ses propres GOT et PLT. Le GOT fait partie du segment de données. Le PLT fait partie du segment de code. <code>Étant donné que addcnt est défini par le module libvector.so, le compilateur peut utiliser la distance constante entre le segment de code et le segment de données pour générer une référence relative PC directe à addcnt, et ajouter une relocalisation pour permettre à l&#x27;éditeur de liens de construire ce module partagé Parse ce. Cependant, si addcnt est défini par un autre module partagé, un accès indirect via GOT est requis. Ici, le compilateur choisit la solution la plus générale, en utilisant GOT pour toutes les références.</code>\ <code>objdump -dx prog</code></p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &lt;main&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%e201028 &lt;z&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 78a : 48 8d 35 7f 08 20 00 lea 0x20087f(%rip),%rsi # 201010 &lt;y&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 791 : 48 8d 3d 80 08 20 00 lea 0x200880(%rip),%rdi # 201018 &lt;x&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 898 a3 fe ff ff callq 640 &lt;addvec@plt&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 79d : 8b 0d 89 08 20 00 mov 0x200889(%rip),%ecx # 20102c &lt;z+0x4&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 7a3 : 8b 15 7f 08 20 00 mov</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> (%rip),%edx # &lt;z&gt;7a9 : 48 8d 35 a4 00 00 00 lea 0xa4(%rip),%rsi # 854 &lt;_IO_stdin_used+0x4&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 7b0 : bf 01 00 00 00 mov $0x1,%edi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 7b5 : b8 00 00 00 00 mov $0x0 ,%eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 7ba : e8 91 fe ff ff callq 650 &lt;__printf_chk@plt&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 7bf : b8 00 00 00 00 mov $0x0,%eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 7c4 : 48 83 c4 08 add $0x8,%rsp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 7c8 : c3 retq   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 7c9 : 0f 1f 80 00 00 00 00 nopl 0x0(%rax)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copie" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>对 Addvevec 函数 和 和 和 PRINRF 函数 的 调用 转化 对 ADDVEC @ plt 和 __ __printf_chk @ plt 函数 的 调用, 这 两 函数 函数 是 在 .Plt 中 的, 而 .Plt 中 的 内容 如下 所</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">Démontage de la section .plt :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000000000000630 &lt;.plt&gt; :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 630 : ff 35 82 09 20 00 pushq 0x200982(%rip) # 200fb8 &lt;_GLOBAL_OFFSET_TABLE_+0x8&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 636 : ff 25 84 09 20 ) # 200fc0 &lt;_global_offset_table_ + 0x10&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 63c: 0f 1f 40 00 NOPL 0x0 (% Rax)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000000000000640 &lt;addvec@plt&gt;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 640: FF 25 82 09 20 00 JMPQ * 0x200982 (% RIP) # 200fc8 &lt;addvec&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 646: 68 00 00 00 00 pushq 0 $ 0x0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 64B: E9 E0 FF FF FF JMPQ 630 &lt;.PLT&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">000000000000650 &lt;__PRINF_CHK @ PLT&gt;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 650: FF 25 7A 09 20 00 JMPQ * 0x20097A (% RIP) # 200fd0 &lt;__printf_chk @ glibc_2. 3.4&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 656 : 68 01 00 00 00 pushq $0x1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 65b : e9 d0 ff ff ff jmpq 630 &lt;.plt&gt;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copie" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>们 们 目标 的 的. 们 的 的. 们 的 的 的.中 对应 的 obtenez 中 保存 的 地址. 比如面 们们 调用 addvevec @ plt 函数 时 会 会行 0x640 的 JMPQ * 0x200982 (% RIP) 指令, 的 0x200982 就 是面 的 距离 常量, 用来 的 距离距离GOT 项, 这里 得到 访问 的 got 的 地址 为 0x200982 + 0x646 = 0x200fc8, 而 该 的 got 内容 所 <code>0x00200fc0 00000000 0000000000000000000000000000000000000000000000000000 0000000000 .....
</code></p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">000000000000000630</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &lt;&gt;FF 35 82 09 20 00 Poussette 0x200982 (% RIP) # 200fb8 &lt;_global_offset_table_ + 0x8&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 636: FF 25 84 09 20 00 JMPQ * 0x200984 (% RIP) # 200fc0 &lt;_global_offset_table_ + 0x10&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 63c : 0f 1f 40 00 nopl 0x0(%rax)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copie" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>中 一 条条 是 将 地址 0x200982 + 0x636 = 0x200fb8 作为 参数 压入栈 转 转 0x200984 + 0x63c = 0x200fc0 处 们 们 们 们 们 们 们 们 们执 目标 的 值 可 的 的 值会 可 的 的 值会 可可 该 的 值会 修改 该 的 值会值会 到 该 的 值会 修改 该 的 的 值会值会值会到什么内存地址。那该函数是如何知道要获得哪个函数的地址，以及要将函数地址保存到哪个got顽保存到哪个got顽</p><p>我们观察可执行目标文件中以下共享库的函数</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">0000000000000640 &lt;addvec@plt&gt;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 640: FF 25 82 09 20 00 JMPQ * 0x200982 (% RIP) # 200FC8 &lt;addvec&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 646: 68 00 00 00 00 Poussette 0x0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 64B: E9 E0 FF FF FF JMPQ 630 &lt;.PLT&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">000000000000000650 &lt;__printf_chk@plt&gt; :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  650 : ff 25 7a 09 20&gt;jmpq *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> (%rip) #</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &lt;630 &lt;.plt&gt;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copie" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>现 现 的 第一条 指令 的 的 的 obtient 的 的 下 一 条 的 地址, 当 当 当 一 一 一 一 一 条 到 下 一Rela.plt的索引</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">La section de relocalisation &#x27;.rela.plt&#x27; à l&#x27;offset 0x5e8 contient 2 entrées :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Offset Info Type Sym. Valeur Sym. Nom + Addend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">000000200fc8 000300000007 R_X86_64_JUMP_SLO 000000000000000 addvec + 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">000000200fd0 000500000007 R_X86_64_JUMP_SLO 000000000 __print@printfC40 __0 300000</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copie" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其中, offset 的 地址, sym.name 就 函数 的 名字. 所以 动态链接 索 引值 数据组 以及 以及 其 定位 动态库函数 以及 以及 其 地址 保存哪个got项。</p><p>的 的 Addvevec 函数 的 内存 地址 保存 下 次 调用 调用 调用 调用 就 就 该 该 该 该 该 能 的 的 的 的 的 的 的 的 内存内存.</p><p>们 现 的 xxx @ 的 xxx @ 的 函数 的 的 的 的 的 的 的中 一 的 的 函数 会 的 的 函数 会 该 的 函数 该 该 的 的 的 函数 方法 方法 的 的 的 的 的 的 的 的 的 的 的 的 的 的 的 地址, 否则 否则 的 的 地址, 否则 否则由此防止可执行目标文件加载时需要对大量的共享库的地址进行重定位。</p><p>所 所 述 要 中 中 中 中 中 的 函数 时 执 行 Call XXX @ PLT, 访问 的 封装：, 然后 的 函数 的 的 的 项, 如果 Vous avez 项 赋值 的 xxx的 的 地址, 会 会 该 该 该 会 调用 调用<!-- -->[0]<!-- --> 调用 调用 定位 xxx定义 的, 编译 器 可以 利用 代码 段 和 数据 段 之间 不变 的 距离, 产生 对 addcnt 的 直接 PC 相对 引用, 并 增加 一个 重 定位, 让 链接 器 在 构造 这个 共享 模块 时 解析 它. 不过, 如果 addcnt是由另一个共享模块定义的,那么就需要通过GOT进行间接访问.在这里,编译器选择采用最通用的解决方案,为所有的引用使用GOT. <img loading="lazy" alt="img_9.png" src="/fr/assets/images/img_9-d1d3c70726ac6a65c9a5585bcc6b97bc.png" width="778" height="932" class="img_E7b_"> Étape 1. Au lieu d&#x27;appeler directement addvec, le programme appelle PLT<!-- -->[2]<!-- -->, dont est l&#x27;entrée PLT pour addvec. \ Étape 2. La première instruction PLT fait un saut indirect à travers GOT<!-- -->[4]<!-- -->. Puisque chaque entrée GOT pointe initialement vers la deuxième instruction dans son entrée PLT correspondante, le saut indirect retransfère simplement le contrôle à l&#x27;instruction suivante dans<!-- -->[2]<!-- --> \ Étape 3. Après avoir poussé un ID pour addvec (0x1) sur la pile, PLT<!-- -->[2]<!-- --> saute à PLT<!-- -->[0]<!-- -->. \ Étape 4. PLT<!-- -->[0]<!-- --> pousse un argument pour l&#x27;éditeur de liens dynamique indirectement via GOT<!-- -->[1]<!-- --> , puis saute dans l&#x27;éditeur de liens dynamique indirectement via GOT<!-- -->[2]<!-- -->. L&#x27;éditeur de liens dynamique utilise les deux entrées de la pile pour déterminer l&#x27;emplacement d&#x27;exécution d&#x27;addvec, écrase GOT<!-- -->[4]<!-- --> avec cette adresse et passe le contrôle à addvec. <img loading="lazy" alt="img_10.png" src="/fr/assets/images/img_10-e75921c4e5bc39941f7a09e28cb31ce8.png" width="694" height="918" class="img_E7b_"> Étape 1. Le contrôle passe à PLT<!-- -->[2]<!-- --> comme précédemment.\ Étape 2. Cependant, cette fois, le saut indirect via GOT<!-- -->[4]<!-- --> transfère le contrôle directement à addvec.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="interposition-de-bibliothèque">Interposition de bibliothèque<a class="hash-link" href="#interposition-de-bibliothèque" title="Lien direct vers la rubrique">​</a></h4><p>l&#x27;interposition de bibliothèque, vous permet d&#x27;intercepter les appels aux fonctions de la bibliothèque partagée et d&#x27;exécuter votre propre code à la place.\ <strong>idée de base :</strong> étant donné une fonction cible sur laquelle interposer, vous créez une fonction wrapper dont le prototype est identique à la fonction cible. En utilisant un mécanisme d&#x27;interposition particulier, vous incitez ensuite le système à appeler la fonction wrapper au lieu de la fonction cible. La fonction enveloppe généralement exécute sa propre logique, puis appelle la fonction cible et renvoie sa valeur de retour à l&#x27;appelant.</p><p>L&#x27;interposition peut se produire au moment de la compilation, de la liaison ou de l&#x27;exécution lorsque le programme est chargé et exécuté. Exemple de programme int.c</p><div class="language-code/link/interpose/int.c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-code/link/interpose/int.c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;stdio.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;malloc.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int main()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int *p = malloc(32);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    libre(p);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    retour(0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copie" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="1-interposition-au-moment-de-la-compilation">1. Interposition au moment de la compilation<a class="hash-link" href="#1-interposition-au-moment-de-la-compilation" title="Lien direct vers la rubrique">​</a></h5><p>Fichier local de malloc.h</p><div class="language-code/link/interpose/malloc.h codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-code/link/interpose/malloc.h codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">#define malloc(taille) mymalloc(taille)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define free(ptr) myfree(ptr)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copie" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后 编译 编译.C 时, 使用 -I 编译 选项 预处理 使得 预处理 预处理 的 的 Malloc.h 的 MALLALLOC 混合 MYMALLALC 混合 MYMADRE 函数. 们 们 们 自己 实现 myMALLOC 和 MYMALLOC 函数, 其中 需要 调用 的 Malloc.h, 由于 Malloc.h 使用 #define 指令, 们们 后面 需要 Malloc 的 地方 被 MyMALLOC 替代. 而 mymalloc.c 代码： Fonctions wrapper dans mymalloc.c</p><div class="language-mymalloc.c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-mymalloc.c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">#ifdef COMPILETIME //编译选项是COMPILETIME ，这段代码才会编译进去</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;stdio.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;malloc.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* fonction wrapper malloc */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void *mymalloc(size_t size)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void *ptr = malloc( Taille);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;malloc(%d)=%p\n&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           (int)taille, ptr);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    points de retour ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* fonction wrapper gratuite */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void myfree(void *ptr)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    free(ptr);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;libre(%p)\n&quot;, ptr);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;COMPILETIME\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#endif</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copie" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>所以我们可以通过以下代码得到该函数的可重定位目标文件mymalloc.o</p><div class="language-shell codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-shell codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">gcc -DCOMPILETIME -c mymalloc.c</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copie" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后在本地的malloc.h中给出包装函数的函数原型，即</p><div class="language-code/link/interpose/malloc.h codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-code/link/interpose/malloc.h codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">#define malloc(taille) mymalloc(taille)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define free(ptr) myfree(ptr)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void *mymalloc(size_t size);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void myfree(void *ptr);</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copie" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后就可以通过以下命令行进行编译时打桩</p><div class="language-shell codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-shell codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">gcc -I. -o intc int.c mymalloc.o</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copie" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>此时, 由于 -i. 编译 选项, 对于 Int.c 中 的 Malloc.h, 预处理 会 从 搜索 Malloc.h 文件, 而 本地 Malloc.h 文件 中, Malloc 和 gratuit 重函数 成mymalloc和myfree函数，而这两个函数在之前编译好的mymalloc.o可重定位目标文件中，此时就完成了编译时打桩。</p><div class="language-shell codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-shell codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">malloc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">0x558ca12fc2a0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">libre</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0x558ca12fc2a0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COMPILETIME</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copie" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用malloc的地方，都被替换成了mymalloc。</p><div class="language-int.i codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-int.i codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">void *mymalloc(taille_t taille);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void myfree(void *ptr);</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copie" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="2-interposition-de-temps-de-liaison">2. Interposition de temps de liaison<a class="hash-link" href="#2-interposition-de-temps-de-liaison" title="Lien direct vers la rubrique">​</a></h5><p>Linux 静态 链接器 也 使用 进 链接 为 __ __ __ __ <strong> 的 </strong> <strong> 的 的 </strong> <strong> 的 </strong> 的 的 引用 的 的 的 引用引用会替换成对<strong>wrap_f函数的调用，而通过</strong>real_f函数来调用原始函数f。 我们定义以下函数</p><div class="language-mymalloc.c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-mymalloc.c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">#ifdef LINKTIME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;stdio.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void *__real_malloc(size_t size);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void __real_free(void *ptr);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* fonction wrapper malloc */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void *__wrap_malloc(size_t size)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void *ptr = __real_malloc(size); /* Appel libc malloc */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;malloc(%d) = %p\n&quot;, (int)size, ptr);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    points de retour ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* fonction wrapper libre */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void __wrap_free(void *ptr)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    __real_free(ptr); /* Appel libc free */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;free(%p)\n&quot;, ptr);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;LINKTIME\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#endif</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copie" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>同时进行编译</p><div class="language-shell codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-shell codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">gcc -DLINKTIME -Wl,--wrap,malloc -Wl,--wrap,free -o intl int.c mymalloc.c</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copie" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>也可以分开编译</p><div class="language-shell codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-shell codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">gcc -DLINKTIME -c mymalloc.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcc -c int.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcc -Wl,--wrap,malloc -Wl,--wrap,free -o intl int.o mymalloc.o</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copie" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>-WL, option 把 标志 标志 给器 .OPtion 中 的 每每个-Wl,--wrap,gratuit。</p><div class="language-shell codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-shell codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">malloc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">0x558ca12fc2a0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">libre</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0x558ca12fc2a0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LINKTIME</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copie" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>由, 利用器 的 打桩 机制, int.c 中 对 Malloc gratuit 函数 的 调用, 会 变成 <strong>wrap_malloc 和 </strong>wrap_free 的 调用. __ __real_malloc 将 被 解析 的 Malloc.</p><p>综上所述：想要在链接时打桩，意味着在对可重定位目标文件的符号进行解析时，进行替换。</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="3-interposition-dexécution">3. Interposition d&#x27;exécution<a class="hash-link" href="#3-interposition-dexécution" title="Lien direct vers la rubrique">​</a></h5><p>运 的 的 ld_preload 的 函数 的 ld_preload 环境 件 的LD_PRELOAD est à  ;</p><div class="language-mymalloc.c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-mymalloc.c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">#ifdef RUNTIME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define _GNU_SOURCE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;stdio.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;stdlib.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;dlfcn.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* fonction wrapper malloc */而__real_malloc将会被解析成真正的malloc。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void *malloc(size_t size)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void *(*mallocp)(taille_t taille);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    caractères *erreur ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mallocp = dlsym(RTLD_NEXT, &quot;malloc&quot;); /* Récupère l&#x27;adresse de libc malloc */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ((error = dlerror()) != NULL) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fputs(error, stderr);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sortie(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    car *ptr = mallocp(taille); /* Appel libc malloc */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// printf(&quot;malloc(%d) = %p\n&quot;, (int)size, ptr);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    points de retour ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* fonction wrapper libre */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void free(void *ptr)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void (*freep)(void *) = NULL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    caractères *erreur ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    si (!ptr)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    retour ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    librep = dlsym(RTLD_NEXT, &quot;libre&quot;); /* Récupère l&#x27;adresse de libc free */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ((error = dlerror()) != NULL) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fputs(error, stderr);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sortie(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    librep(ptr); /* Appel libc free */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;free(%p)\n&quot;, ptr);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;RUNTIME\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#endif</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copie" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后通过以下命令行将其编译成共享库</p><div class="language-shell codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-shell codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">gcc -DRUNTIME -shared -fpic -o mymalloc.so mymalloc.c -ldl </span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copie" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后编译，在运行时指定环境变量LD_PRELOAD</p><div class="language-shell codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-shell codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">gcc -o intr int.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">LD_PRELOAD</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;./mymalloc.so&quot;</span><span class="token plain"> ./intr </span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copie" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>此时行 到 Malloc 和 gratuit 函数 调用 调用 调用 调用 调用 调用 调用 的 的 的 定义, 而 的 共 享库, 而 myMALLOC.SO 中 定义 这 两 个 符号 个 个个 的 的 的 的 的 方式 的 的 的 方式 的 的 的 方式 的 方式 的 方式为 的 的 的 的为 中 获得 的 共 享库 中 获得：的 享库共 中 获得</p><div class="language-shell codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-shell codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">&quot;./mymalloc.so&quot;</span><span class="token plain"> ./intr </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">libre</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0x55a98bc572a0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DURÉE D&#x27;EXÉCUTION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copie" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Gnu binutils 包 有 有 可以 可以 可以 可以 在 在 在 在 在 在 在 在 在 在 在 在个 平台. ar：创建 静态库, 删除, 列出 和 提取. cordes：一个 目标 的 字符串. bande：目标 目标 文件 中 删除 符号 信息. nm：列出 一个 目标 的 符号 中 的 符号. Taille：列出 目标 文件 中节 的 名字名字 大小. LOOTAGE：显示 一个 目标 文件 的完整, 包括 elf 中 的 所有 信息. 包含 Taille 和 nm 的 功能. objdump：二进制有 二进制有 二进制有 二进制 工件 件 件 大 的 作用 目标 它 大 的 作用 信息 .text 节中 的.二进制指令。 Linux 系统为操作共享库还提供了 LDD 程序： LDD 程出一个：文件在运行时所需时所需</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Malaaaa/blog-sample/tree/main/docs/CSAPP/Linking.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Modifier cette page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Navigation dans les pages de documentation"><a class="pagination-nav__link pagination-nav__link--prev" href="/fr/docs/CSAPP/I/O"><div class="pagination-nav__sublabel">Précédent</div><div class="pagination-nav__label">O</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/fr/docs/CSAPP/Network"><div class="pagination-nav__sublabel">Suivant</div><div class="pagination-nav__label">Network</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#traduit-le-programme-dexemple-dun-fichier-source-ascii-en-un-fichier-objet-exécutable" class="table-of-contents__link toc-highlight">Traduit le programme d&#39;exemple d&#39;un fichier source ASCII en un fichier objet exécutable.</a></li><li><a href="#fichiers-objet" class="table-of-contents__link toc-highlight">Fichiers objet</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Malaaaa Site. Construit avec Docusaurus.</div></div></div></footer></div>
<script src="/fr/assets/js/runtime~main.fce25c65.js"></script>
<script src="/fr/assets/js/main.38d4393c.js"></script>
</body>
</html>